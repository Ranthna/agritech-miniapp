<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Agritech Pioneers</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: var(--tg-theme-bg-color, #ffffff);
            color: var(--tg-theme-text-color, #000000);
            padding: 16px;
            min-height: 100vh;
        }

        .container {
            max-width: 600px;
            margin: 0 auto;
        }

        .header {
            text-align: center;
            margin-bottom: 24px;
            padding: 20px;
            background: linear-gradient(135deg, #22c55e 0%, #16a34a 100%);
            border-radius: 16px;
            color: white;
        }

        .header h1 {
            font-size: 24px;
            margin-bottom: 8px;
        }

        .header p {
            font-size: 14px;
            opacity: 0.9;
        }

        .language-selector {
            display: flex;
            gap: 8px;
            justify-content: center;
            margin-bottom: 20px;
        }

        .lang-btn {
            padding: 8px 16px;
            border: 2px solid #22c55e;
            background: white;
            border-radius: 8px;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.3s;
        }

        .lang-btn.active {
            background: #22c55e;
            color: white;
        }

        .screen {
            display: none;
        }

        .screen.active {
            display: block;
            animation: fadeIn 0.3s;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(10px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .role-card {
            background: white;
            border: 2px solid #e5e7eb;
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 12px;
            cursor: pointer;
            transition: all 0.3s;
        }

        .role-card:hover {
            border-color: #22c55e;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(34, 197, 94, 0.1);
        }

        .role-card h3 {
            font-size: 18px;
            margin-bottom: 8px;
            color: #22c55e;
        }

        .role-card p {
            font-size: 14px;
            color: #6b7280;
        }

        .form-group {
            margin-bottom: 16px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
            font-size: 14px;
        }

        .form-group input,
        .form-group select,
        .form-group textarea {
            width: 100%;
            padding: 12px;
            border: 2px solid #e5e7eb;
            border-radius: 8px;
            font-size: 14px;
            transition: border-color 0.3s;
        }

        .form-group input:focus,
        .form-group select:focus,
        .form-group textarea:focus {
            outline: none;
            border-color: #22c55e;
        }

        .btn {
            width: 100%;
            padding: 14px;
            background: #22c55e;
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: background 0.3s;
        }

        .btn:hover {
            background: #16a34a;
        }

        .btn-secondary {
            background: #6b7280;
        }

        .btn-secondary:hover {
            background: #4b5563;
        }

        .feature-grid {
            display: grid;
            grid-template-columns: 1fr;
            gap: 12px;
            margin-top: 20px;
        }

        .feature-card {
            background: white;
            border: 2px solid #e5e7eb;
            border-radius: 12px;
            padding: 20px;
            cursor: pointer;
            transition: all 0.3s;
        }

        .feature-card:hover {
            border-color: #22c55e;
            transform: translateY(-2px);
        }

        .feature-card .icon {
            font-size: 32px;
            margin-bottom: 12px;
        }

        .feature-card h3 {
            font-size: 18px;
            margin-bottom: 8px;
        }

        .feature-card p {
            font-size: 14px;
            color: #6b7280;
        }

        .weather-card {
            background: linear-gradient(135deg, #3b82f6 0%, #2563eb 100%);
            color: white;
            border-radius: 16px;
            padding: 24px;
            margin-bottom: 16px;
        }

        .weather-main {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .weather-temp {
            font-size: 48px;
            font-weight: bold;
        }

        .weather-icon {
            font-size: 64px;
        }

        .weather-details {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 12px;
        }

        .weather-detail-item {
            background: rgba(255, 255, 255, 0.2);
            padding: 12px;
            border-radius: 8px;
        }

        .weather-detail-item strong {
            display: block;
            margin-bottom: 4px;
            font-size: 12px;
        }

        .location-btn {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            margin-bottom: 16px;
        }

        .location-btn::before {
            content: "üìç";
            font-size: 20px;
        }

        .progress-bar {
            width: 100%;
            height: 8px;
            background: #e5e7eb;
            border-radius: 4px;
            margin-bottom: 20px;
            overflow: hidden;
        }

        .progress-fill {
            height: 100%;
            background: #22c55e;
            transition: width 0.3s;
        }

        .step-indicator {
            text-align: center;
            margin-bottom: 16px;
            font-size: 14px;
            color: #6b7280;
        }

        .voice-recorder {
            text-align: center;
            padding: 40px 20px;
        }

        .voice-btn {
            width: 80px;
            height: 80px;
            border-radius: 50%;
            background: #22c55e;
            color: white;
            border: none;
            font-size: 32px;
            cursor: pointer;
            transition: all 0.3s;
            margin: 0 auto;
            display: block;
        }

        .voice-btn:hover {
            transform: scale(1.1);
        }

        .voice-btn.recording {
            background: #ef4444;
            animation: pulse 1s infinite;
        }

        @keyframes pulse {

            0%,
            100% {
                transform: scale(1);
            }

            50% {
                transform: scale(1.05);
            }
        }

        .back-btn {
            background: transparent;
            border: 2px solid #22c55e;
            color: #22c55e;
            margin-top: 12px;
        }

        .back-btn:hover {
            background: #22c55e;
            color: white;
        }

        .success-message {
            text-align: center;
            padding: 40px 20px;
        }

        .success-icon {
            font-size: 64px;
            margin-bottom: 16px;
        }

        .completed-badge {
            display: inline-block;
            background: #22c55e;
            color: white;
            padding: 4px 12px;
            border-radius: 12px;
            font-size: 12px;
            margin-left: 8px;
        }

        .video-container {
            position: relative;
            width: 100%;
            padding-bottom: 56.25%;
            background: #000;
            border-radius: 12px;
            overflow: hidden;
            margin-bottom: 16px;
        }

        .video-container iframe {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
        }

        .faq-item {
            background: white;
            border: 2px solid #e5e7eb;
            border-radius: 8px;
            padding: 16px;
            margin-bottom: 12px;
        }

        .faq-question {
            font-weight: 600;
            margin-bottom: 8px;
            cursor: pointer;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .faq-answer {
            display: none;
            color: #6b7280;
            font-size: 14px;
            margin-top: 8px;
        }

        .faq-answer.show {
            display: block;
        }

        .loading {
            display: none;
            text-align: center;
            padding: 20px;
            color: #22c55e;
        }

        .loading.show {
            display: block;
        }
    </style>
</head>

<body>
    <div class="container">
        <div class="header">
            <h1 id="app-title">üåæ Agritech Pioneers</h1>
            <p id="app-subtitle">Empowering Farmers with Technology</p>
        </div>

        <div class="language-selector">
            <button class="lang-btn active" onclick="setLanguage('en')">English</button>
            <button class="lang-btn" onclick="setLanguage('km')">·ûó·û∂·ûü·û∂·ûÅ·üí·ûò·üÇ·ûö</button>
        </div>

        <!-- Welcome Screen -->
        <div id="welcome-screen" class="screen active">
            <div style="text-align: center; margin-bottom: 24px;">
                <h2 id="welcome-title">Welcome to Agritech Pioneers!</h2>
                <p id="welcome-desc" style="margin-top: 12px; color: #6b7280;">Please select your role to continue</p>
            </div>

            <div class="role-card" onclick="selectRole('farmer')">
                <h3 id="role-farmer-title">üë®‚Äçüåæ Normal Farmer</h3>
                <p id="role-farmer-desc">Access weather updates, book services, and get processing guidance</p>
            </div>

            <div class="role-card" onclick="selectRole('provider')">
                <h3 id="role-provider-title">üöú Service Provider / Middleman</h3>
                <p id="role-provider-desc">Offer equipment and services to farmers in your area</p>
            </div>

            <div class="role-card" onclick="selectRole('manager')">
                <h3 id="role-manager-title">üìä Data Manager</h3>
                <p id="role-manager-desc">Access analytics and manage agricultural data</p>
            </div>
        </div>

        <!-- Farmer Registration Screen -->
        <div id="registration-screen" class="screen">
            <h2 id="reg-title">Farmer Registration</h2>
            <p id="reg-subtitle" style="margin-bottom: 20px; color: #6b7280;">Please provide your information</p>

            <form id="registration-form">
                <div class="form-group">
                    <label id="label-name">Full Name</label>
                    <input type="text" id="farmer-name" required>
                </div>

                <div class="form-group">
                    <label id="label-phone">Phone Number</label>
                    <input type="tel" id="farmer-phone" required>
                </div>

                <div class="form-group">
                    <label id="label-location">Farm Location</label>
                    <button type="button" class="btn location-btn" onclick="shareLocation()" id="btn-location">
                        Share Location via Telegram
                    </button>
                    <input type="text" id="location-display" readonly placeholder="No location shared yet">
                </div>

                <div class="loading" id="registration-loading">
                    <p>Saving your registration...</p>
                </div>

                <button type="submit" class="btn" id="btn-register">Complete Registration</button>
            </form>

            <button class="btn back-btn" onclick="showScreen('welcome-screen')" id="btn-back">Back</button>
        </div>

        <!-- Farmer Dashboard -->
        <div id="dashboard-screen" class="screen">
            <h2 id="dashboard-welcome">Welcome Back! <span id="farmer-name-display"></span></h2>
            <p id="dashboard-subtitle" style="margin-bottom: 20px; color: #6b7280;">Choose a service below</p>

            <div class="feature-grid">
                <div class="feature-card" onclick="showScreen('weather-screen')">
                    <div class="icon">üå§Ô∏è</div>
                    <h3 id="feature-weather-title">Weather Updates</h3>
                    <p id="feature-weather-desc">Get real-time local weather information</p>
                </div>

                <div class="feature-card" onclick="showScreen('booking-screen')">
                    <div class="icon">üìÖ</div>
                    <h3 id="feature-booking-title">Book Services</h3>
                    <p id="feature-booking-desc">Request equipment and farm services</p>
                </div>

                <div class="feature-card" onclick="showScreen('processing-screen')">
                    <div class="icon">üéì</div>
                    <h3 id="feature-processing-title">Processing Guidance</h3>
                    <p id="feature-processing-desc">Get help with post-harvest practices</p>
                </div>
            </div>
        </div>

        <!-- Weather Screen -->
        <div id="weather-screen" class="screen">
            <h2 id="weather-title">Weather Updates</h2>

            <div class="weather-card">
                <div class="weather-main">
                    <div>
                        <div id="weather-location" style="font-size: 18px; margin-bottom: 8px;">Loading...</div>
                        <div class="weather-temp" id="weather-temp">--¬∞C</div>
                        <div id="weather-condition">Loading weather data...</div>
                    </div>
                    <div class="weather-icon" id="weather-icon">‚õÖ</div>
                </div>

                <div class="weather-details">
                    <div class="weather-detail-item">
                        <strong id="label-humidity">Humidity</strong>
                        <div id="weather-humidity">--%</div>
                    </div>
                    <div class="weather-detail-item">
                        <strong id="label-wind">Wind Speed</strong>
                        <div id="weather-wind">-- km/h</div>
                    </div>
                    <div class="weather-detail-item">
                        <strong id="label-rainfall">Rainfall</strong>
                        <div id="weather-rainfall">-- mm</div>
                    </div>
                    <div class="weather-detail-item">
                        <strong id="label-forecast">Forecast</strong>
                        <div id="weather-forecast">--</div>
                    </div>
                </div>
            </div>

            <div class="completed-badge">‚úì <span id="badge-completed">Completed</span></div>

            <button class="btn back-btn" onclick="showScreen('dashboard-screen')" id="btn-back-dashboard">Back to
                Dashboard</button>
        </div>

        <!-- Booking Screen -->
        <div id="booking-screen" class="screen">
            <h2 id="booking-title">Book Services</h2>

            <div class="progress-bar">
                <div class="progress-fill" id="booking-progress" style="width: 0%"></div>
            </div>
            <div class="step-indicator" id="booking-step">Step 1 of 6</div>

            <form id="booking-form">
                <!-- Step 1: Name -->
                <div class="booking-step-content" id="step-1">
                    <div class="form-group">
                        <label id="label-confirm-name">Confirm Your Name</label>
                        <input type="text" id="booking-name" required>
                    </div>
                    <button type="button" class="btn" onclick="nextBookingStep()" id="btn-next">Next</button>
                </div>

                <!-- Step 2: Age -->
                <div class="booking-step-content" id="step-2" style="display: none;">
                    <div class="form-group">
                        <label id="label-age">Age</label>
                        <input type="number" id="booking-age" min="18" max="100" required>
                    </div>
                    <button type="button" class="btn" onclick="nextBookingStep()">Next</button>
                    <button type="button" class="btn back-btn" onclick="prevBookingStep()"
                        id="btn-previous">Previous</button>
                </div>

                <!-- Step 3: Address -->
                <div class="booking-step-content" id="step-3" style="display: none;">
                    <div class="form-group">
                        <label id="label-address">Full Address</label>
                        <textarea id="booking-address" rows="3" required></textarea>
                    </div>
                    <button type="button" class="btn" onclick="nextBookingStep()">Next</button>
                    <button type="button" class="btn back-btn" onclick="prevBookingStep()">Previous</button>
                </div>

                <!-- Step 4: Farm Size -->
                <div class="booking-step-content" id="step-4" style="display: none;">
                    <div class="form-group">
                        <label id="label-farm-size">Farm Size (hectares)</label>
                        <input type="number" id="booking-farm-size" step="0.1" required>
                    </div>
                    <button type="button" class="btn" onclick="nextBookingStep()">Next</button>
                    <button type="button" class="btn back-btn" onclick="prevBookingStep()">Previous</button>
                </div>

                <!-- Step 5: Equipment -->
                <div class="booking-step-content" id="step-5" style="display: none;">
                    <div class="form-group">
                        <label id="label-equipment">Required Equipment/Service</label>
                        <select id="booking-equipment" required>
                            <option value="">-- Select --</option>
                            <option value="tractor" id="opt-tractor">Tractor</option>
                            <option value="harvester" id="opt-harvester">Harvester</option>
                            <option value="plowing" id="opt-plowing">Plowing Service</option>
                            <option value="irrigation" id="opt-irrigation">Irrigation System</option>
                            <option value="fertilizer" id="opt-fertilizer">Fertilizer Application</option>
                            <option value="other" id="opt-other">Other</option>
                        </select>
                    </div>
                    <button type="button" class="btn" onclick="nextBookingStep()">Next</button>
                    <button type="button" class="btn back-btn" onclick="prevBookingStep()">Previous</button>
                </div>

                <!-- Step 6: Date -->
                <div class="booking-step-content" id="step-6" style="display: none;">
                    <div class="form-group">
                        <label id="label-date">Preferred Service Date</label>
                        <input type="date" id="booking-date" required>
                    </div>
                    <div class="loading" id="booking-loading">
                        <p>Submitting your booking...</p>
                    </div>
                    <button type="submit" class="btn" id="btn-submit-booking">Submit Booking</button>
                    <button type="button" class="btn back-btn" onclick="prevBookingStep()">Previous</button>
                </div>
            </form>

            <button class="btn back-btn" onclick="showScreen('dashboard-screen')"
                style="margin-top: 12px;">Cancel</button>
        </div>

        <!-- Booking Success Screen -->
        <div id="booking-success-screen" class="screen">
            <div class="success-message">
                <div class="success-icon">‚úÖ</div>
                <h2 id="success-title">Booking Confirmed!</h2>
                <p id="success-message" style="margin: 16px 0; color: #6b7280;">Your service request has been submitted
                    successfully. We will contact you soon.</p>
                <div class="completed-badge">‚úì Completed</div>
            </div>
            <button class="btn" onclick="showScreen('dashboard-screen')" id="btn-back-home">Back to Home</button>
        </div>

        <!-- Processing Guidance Screen -->
        <div id="processing-screen" class="screen">
            <h2 id="processing-title">Processing Guidance</h2>
            <p id="processing-subtitle" style="margin-bottom: 20px; color: #6b7280;">Get help with post-harvest
                practices</p>

            <div class="feature-grid">
                <div class="feature-card" onclick="showScreen('voice-question-screen')">
                    <div class="icon">üé§</div>
                    <h3 id="voice-question-title">Ask via Voice</h3>
                    <p id="voice-question-desc">Record your question and get answers</p>
                </div>

                <div class="feature-card" onclick="showScreen('video-guides-screen')">
                    <div class="icon">üìπ</div>
                    <h3 id="video-guides-title">Video Guides</h3>
                    <p id="video-guides-desc">Watch instructional videos</p>
                </div>

                <div class="feature-card" onclick="showScreen('faq-screen')">
                    <div class="icon">‚ùì</div>
                    <h3 id="faq-title">Common Questions</h3>
                    <p id="faq-desc">Browse frequently asked questions</p>
                </div>
            </div>

            <button class="btn back-btn" onclick="showScreen('dashboard-screen')">Back to Dashboard</button>
        </div>

        <!-- Voice Question Screen -->
        <div id="voice-question-screen" class="screen">
            <h2 id="voice-rec-title">Record Your Question</h2>
            <p id="voice-rec-subtitle" style="margin-bottom: 20px; text-align: center; color: #6b7280;">Tap the button
                to start recording</p>

            <div class="voice-recorder">
                <button class="voice-btn" id="voice-btn" onclick="toggleRecording()">üé§</button>
                <p id="recording-status" style="margin-top: 20px; color: #6b7280;">Ready to record</p>
            </div>

            <div id="voice-response"
                style="display: none; margin-top: 24px; padding: 20px; background: white; border-radius: 12px; border: 2px solid #e5e7eb;">
                <h3 id="response-title">Response:</h3>
                <p id="response-text" style="margin-top: 12px; line-height: 1.6;"></p>
                <div class="completed-badge" style="margin-top: 12px;">‚úì Completed</div>
            </div>

            <button class="btn back-btn" onclick="showScreen('processing-screen')">Back</button>
        </div>

        <!-- Video Guides Screen -->
        <div id="video-guides-screen" class="screen">
            <h2 id="video-title">Instructional Videos</h2>

            <div style="margin-top: 20px;">
                <h3 id="video1-title">Rice Drying Techniques</h3>
                <div class="video-container">
                    <iframe src="https://www.youtube.com/embed/dQw4w9WgXcQ" frameborder="0" allowfullscreen></iframe>
                </div>
                <p id="video1-desc" style="color: #6b7280; margin-bottom: 24px;">Learn proper methods for drying rice
                    after harvest to prevent mold and maintain quality.</p>

                <h3 id="video2-title">Proper Storage Methods</h3>
                <div class="video-container">
                    <iframe src="https://www.youtube.com/embed/dQw4w9WgXcQ" frameborder="0" allowfullscreen></iframe>
                </div>
                <p id="video2-desc" style="color: #6b7280; margin-bottom: 24px;">Discover best practices for storing
                    crops to maximize shelf life and minimize losses.</p>

                <div class="completed-badge">‚úì Completed</div>
            </div>

            <button class="btn back-btn" onclick="showScreen('processing-screen')">Back</button>
        </div>

        <!-- FAQ Screen -->
        <div id="faq-screen" class="screen">
            <h2 id="faq-screen-title">Common Questions</h2>

            <div style="margin-top: 20px;">
                <div class="faq-item">
                    <div class="faq-question" onclick="toggleFAQ(1)">
                        <span id="faq1-q">How long should I dry my rice?</span>
                        <span>‚ñº</span>
                    </div>
                    <div class="faq-answer" id="faq-1">
                        <span id="faq1-a">Rice should be dried until moisture content reaches 14% or lower. This
                            typically takes 2-3 days in good sun conditions.</span>
                    </div>
                </div>

                <div class="faq-item">
                    <div class="faq-question" onclick="toggleFAQ(2)">
                        <span id="faq2-q">What temperature is best for crop storage?</span>
                        <span>‚ñº</span>
                    </div>
                    <div class="faq-answer" id="faq-2">
                        <span id="faq2-a">Most crops should be stored at 10-15¬∞C with humidity below 60% to prevent
                            spoilage.</span>
                    </div>
                </div>

                <div class="faq-item">
                    <div class="faq-question" onclick="toggleFAQ(3)">
                        <span id="faq3-q">How do I prevent pest infestation?</span>
                        <span>‚ñº</span>
                    </div>
                    <div class="faq-answer" id="faq-3">
                        <span id="faq3-a">Ensure proper cleaning of storage areas, use sealed containers, and maintain
                            low moisture levels. Regular inspection is crucial.</span>
                    </div>
                </div>

                <div class="completed-badge">‚úì Completed</div>
            </div>

            <button class="btn back-btn" onclick="showScreen('processing-screen')">Back</button>
        </div>
    </div>

    <script>
        // Initialize Telegram WebApp
        let tg = window.Telegram.WebApp;
        tg.expand();
        tg.ready();

        // State management
        let currentLanguage = 'en';
        let currentBookingStep = 1;
        let isRecording = false;
        let userData = {};

        // API Base URL - Change this to your server URL
        const API_BASE_URL = 'http://localhost:3000/api'; // For local development
        // const API_BASE_URL = 'https://your-deployed-server.com/api'; // For production

        // ===== API FUNCTIONS =====
        async function apiCall(endpoint, method = 'GET', data = null) {
            try {
                const options = {
                    method: method,
                    headers: { 'Content-Type': 'application/json' }
                };

                if (data) {
                    options.body = JSON.stringify(data);
                }

                const response = await fetch(`${API_BASE_URL}${endpoint}`, options);
                const result = await response.json();
                return result;
            } catch (error) {
                console.error(`API Error [${endpoint}]:`, error);
                return { success: false, error: error.message };
            }
        }

        async function registerUser(userData) {
            return await apiCall('/register', 'POST', userData);
        }

        async function getUser(telegramId) {
            return await apiCall(`/user/${telegramId}`, 'GET');
        }

        async function bookService(bookingData) {
            return await apiCall('/bookings', 'POST', bookingData);
        }

        async function saveProcessingGuide(guideData) {
            return await apiCall('/processing', 'POST', guideData);
        }

        // Translations
        const translations = {
            en: {
                'app-title': 'üåæ Agritech Pioneers',
                'app-subtitle': 'Empowering Farmers with Technology',
                'welcome-title': 'Welcome to Agritech Pioneers!',
                'welcome-desc': 'Please select your role to continue',
                'role-farmer-title': 'üë®‚Äçüåæ Normal Farmer',
                'role-farmer-desc': 'Access weather updates, book services, and get processing guidance',
                'role-provider-title': 'üöú Service Provider / Middleman',
                'role-provider-desc': 'Offer equipment and services to farmers in your area',
                'role-manager-title': 'üìä Data Manager',
                'role-manager-desc': 'Access analytics and manage agricultural data',
                'reg-title': 'Farmer Registration',
                'reg-subtitle': 'Please provide your information',
                'label-name': 'Full Name',
                'label-phone': 'Phone Number',
                'label-location': 'Farm Location',
                'btn-location': 'Share Location via Telegram',
                'btn-register': 'Complete Registration',
                'btn-back': 'Back',
                'dashboard-welcome': 'Welcome Back!',
                'dashboard-subtitle': 'Choose a service below',
                'feature-weather-title': 'Weather Updates',
                'feature-weather-desc': 'Get real-time local weather information',
                'feature-booking-title': 'Book Services',
                'feature-booking-desc': 'Request equipment and farm services',
                'feature-processing-title': 'Processing Guidance',
                'feature-processing-desc': 'Get help with post-harvest practices',
                'weather-title': 'Weather Updates',
                'label-humidity': 'Humidity',
                'label-wind': 'Wind Speed',
                'label-rainfall': 'Rainfall',
                'label-forecast': 'Forecast',
                'badge-completed': 'Completed',
                'btn-back-dashboard': 'Back to Dashboard',
                'booking-title': 'Book Services',
                'label-confirm-name': 'Confirm Your Name',
                'label-age': 'Age',
                'label-address': 'Full Address',
                'label-farm-size': 'Farm Size (hectares)',
                'label-equipment': 'Required Equipment/Service',
                'label-date': 'Preferred Service Date',
                'btn-next': 'Next',
                'btn-previous': 'Previous',
                'btn-submit-booking': 'Submit Booking',
                'opt-tractor': 'Tractor',
                'opt-harvester': 'Harvester',
                'opt-plowing': 'Plowing Service',
                'opt-irrigation': 'Irrigation System',
                'opt-fertilizer': 'Fertilizer Application',
                'opt-other': 'Other',
                'success-title': 'Booking Confirmed!',
                'success-message': 'Your service request has been submitted successfully. We will contact you soon.',
                'btn-back-home': 'Back to Home',
                'processing-title': 'Processing Guidance',
                'processing-subtitle': 'Get help with post-harvest practices',
                'voice-question-title': 'Ask via Voice',
                'voice-question-desc': 'Record your question and get answers',
                'video-guides-title': 'Video Guides',
                'video-guides-desc': 'Watch instructional videos',
                'faq-title': 'Common Questions',
                'faq-desc': 'Browse frequently asked questions',
                'voice-rec-title': 'Record Your Question',
                'voice-rec-subtitle': 'Tap the button to start recording',
                'response-title': 'Response:',
                'video-title': 'Instructional Videos',
                'video1-title': 'Rice Drying Techniques',
                'video1-desc': 'Learn proper methods for drying rice after harvest to prevent mold and maintain quality.',
                'video2-title': 'Proper Storage Methods',
                'video2-desc': 'Discover best practices for storing crops to maximize shelf life and minimize losses.',
                'faq-screen-title': 'Common Questions',
                'faq1-q': 'How long should I dry my rice?',
                'faq1-a': 'Rice should be dried until moisture content reaches 14% or lower. This typically takes 2-3 days in good sun conditions.',
                'faq2-q': 'What temperature is best for crop storage?',
                'faq2-a': 'Most crops should be stored at 10-15¬∞C with humidity below 60% to prevent spoilage.',
                'faq3-q': 'How do I prevent pest infestation?',
                'faq3-a': 'Ensure proper cleaning of storage areas, use sealed containers, and maintain low moisture levels. Regular inspection is crucial.'
            },
            km: {
                'app-title': 'üåæ ·û¢·üí·ûì·ûÄ·ûè·üí·ûö·ûΩ·ûü·ûè·üí·ûö·û∂·ûô·ûÄ·ûü·û∑·ûÄ·ûò·üí·ûò',
                'app-subtitle': '·ûî·ûÑ·üí·ûÄ·ûæ·ûì·ûü·ûò·ûè·üí·ûê·ûó·û∂·ûñ·ûÄ·ûü·û∑·ûÄ·ûö·ûä·üÑ·ûô·ûî·ûÖ·üí·ûÖ·üÅ·ûÄ·ûú·û∑·ûë·üí·ûô·û∂',
                'welcome-title': '·ûü·ûº·ûò·ûü·üí·ûú·û∂·ûÇ·ûò·ûì·üç·ûò·ûÄ·ûÄ·û∂·ûì·üã Agritech Pioneers!',
                'welcome-desc': '·ûü·ûº·ûò·ûá·üí·ûö·ûæ·ûü·ûö·ûæ·ûü·ûè·ûΩ·ûì·û∂·ûë·û∏·ûö·ûî·ûü·üã·û¢·üí·ûì·ûÄ·ûä·ûæ·ûò·üí·ûî·û∏·ûî·ûì·üí·ûè',
                'role-farmer-title': 'üë®‚Äçüåæ ·ûÄ·ûü·û∑·ûÄ·ûö·ûí·ûò·üí·ûò·ûè·û∂',
                'role-farmer-desc': '·ûÖ·ûº·ûõ·ûî·üí·ûö·ûæ·ûñ·üê·ûè·üå·ûò·û∂·ûì·û¢·û∂·ûÄ·û∂·ûü·ûí·û∂·ûè·ûª ·ûÄ·ûÄ·üã·ûü·üÅ·ûú·û∂ ·ûì·û∑·ûÑ·ûÄ·û∂·ûö·ûé·üÇ·ûì·û∂·üÜ·ûÄ·üÇ·ûÖ·üí·ûì·üÉ',
                'role-provider-title': 'üöú ·û¢·üí·ûì·ûÄ·ûï·üí·ûè·ûõ·üã·ûü·üÅ·ûú·û∂ / ·û¢·ûì·üí·ûè·ûö·ûÄ·û∂·ûö·û∏',
                'role-provider-desc': '·ûï·üí·ûè·ûõ·üã·ûß·ûî·ûÄ·ûö·ûé·üç ·ûì·û∑·ûÑ·ûü·üÅ·ûú·û∂·ûÄ·ûò·üí·ûò·ûä·ûõ·üã·ûÄ·ûü·û∑·ûÄ·ûö·ûÄ·üí·ûì·ûª·ûÑ·ûè·üÜ·ûî·ûì·üã·ûö·ûî·ûü·üã·û¢·üí·ûì·ûÄ',
                'role-manager-title': 'üìä ·û¢·üí·ûì·ûÄ·ûÇ·üí·ûö·ûî·üã·ûÇ·üí·ûö·ûÑ·ûë·û∑·ûì·üí·ûì·ûì·üê·ûô',
                'role-manager-desc': '·ûÖ·ûº·ûõ·ûî·üí·ûö·ûæ·ûÄ·û∂·ûö·ûú·û∑·ûó·û∂·ûÇ ·ûì·û∑·ûÑ·ûÇ·üí·ûö·ûî·üã·ûÇ·üí·ûö·ûÑ·ûë·û∑·ûì·üí·ûì·ûì·üê·ûô·ûÄ·ûü·û∑·ûÄ·ûò·üí·ûò',
                'reg-title': '·ûÄ·û∂·ûö·ûÖ·ûª·üá·ûà·üí·ûò·üÑ·üá·ûÄ·ûü·û∑·ûÄ·ûö',
                'reg-subtitle': '·ûü·ûº·ûò·ûï·üí·ûè·ûõ·üã·ûñ·üê·ûè·üå·ûò·û∂·ûì·ûö·ûî·ûü·üã·û¢·üí·ûì·ûÄ',
                'label-name': '·ûà·üí·ûò·üÑ·üá·ûñ·üÅ·ûâ',
                'label-phone': '·ûõ·üÅ·ûÅ·ûë·ûº·ûö·ûü·üê·ûñ·üí·ûë',
                'label-location': '·ûë·û∏·ûè·û∂·üÜ·ûÑ·ûÄ·ûü·û∑·ûä·üí·ûã·û∂·ûì',
                'btn-location': '·ûÖ·üÇ·ûÄ·ûö·üÜ·ûõ·üÇ·ûÄ·ûë·û∏·ûè·û∂·üÜ·ûÑ·ûè·û∂·ûò Telegram',
                'btn-register': '·ûî·ûâ·üí·ûÖ·ûî·üã·ûÄ·û∂·ûö·ûÖ·ûª·üá·ûà·üí·ûò·üÑ·üá',
                'btn-back': '·ûê·ûô·ûÄ·üí·ûö·üÑ·ûô',
                'dashboard-welcome': '·ûü·ûº·ûò·ûü·üí·ûú·û∂·ûÇ·ûò·ûì·üç·ûÄ·û∂·ûö·ûè·üí·ûö·û°·ûî·üã·ûò·ûÄ·ûú·û∑·ûâ!',
                'dashboard-subtitle': '·ûá·üí·ûö·ûæ·ûü·ûö·ûæ‡§∏‡§∏·üÅ·ûú·û∂·ûÅ·û∂·ûÑ·ûÄ·üí·ûö·üÑ·ûò',
                'feature-weather-title': '·ûñ·üê·ûè·üå·ûò·û∂·ûì·û¢·û∂·ûÄ·û∂·ûü·ûí·û∂·ûè·ûª',
                'feature-weather-desc': '·ûë·ûë·ûΩ·ûõ·ûñ·üê·ûè·üå·ûò·û∂·ûì·û¢·û∂·ûÄ·û∂·ûü·ûí·û∂·ûè·ûª·ûÄ·üí·ûì·ûª·ûÑ·ûè·üÜ·ûî·ûì·üã·ûñ·üÅ·ûõ·ûú·üÅ·ûõ·û∂·ûá·û∂·ûÄ·üã·ûü·üí·ûè·üÇ·ûÑ',
                'feature-booking-title': '·ûÄ·ûÄ·üã·ûü·üÅ·ûú·û∂',
                'feature-booking-desc': '·ûü·üí·ûì·ûæ·ûü·ûª·üÜ·ûß·ûî·ûÄ·ûö·ûé·üç ·ûì·û∑·ûÑ·ûü·üÅ·ûú·û∂·ûÄ·ûò·üí·ûò·ûÄ·ûü·û∑·ûä·üí·ûã·û∂·ûì',
                'feature-processing-title': '·ûÄ·û∂·ûö·ûé·üÇ·ûì·û∂·üÜ·ûÄ·üÇ·ûÖ·üí·ûì·üÉ',
                'feature-processing-desc': '·ûë·ûë·ûΩ·ûõ·ûá·üÜ·ûì·ûΩ·ûô·û¢·üÜ·ûñ·û∏·ûÄ·û∂·ûö·û¢·ûì·ûª·ûú·ûè·üí·ûè·ûÄ·üí·ûö·üÑ·ûô·ûî·üí·ûö·ûò·ûº·ûõ·ûï·ûõ',
                'weather-title': '·ûñ·üê·ûè·üå·ûò·û∂·ûì·û¢·û∂·ûÄ·û∂·ûü·ûí·û∂·ûè·ûª',
                'label-humidity': '·ûü·üÜ·ûé·ûæ·ûò',
                'label-wind': '·ûõ·üí·ûî·ûø·ûì·ûÅ·üí·ûô·ûõ·üã',
                'label-rainfall': '·ûî·ûö·û∑·ûò·û∂·ûé·ûë·ûπ·ûÄ·ûó·üí·ûõ·üÄ·ûÑ',
                'label-forecast': '·ûÄ·û∂·ûö·ûñ·üí·ûô·û∂·ûÄ·ûö·ûé·üç',
                'badge-completed': '·ûî·û∂·ûì·ûî·ûâ·üí·ûÖ·ûî·üã',
                'btn-back-dashboard': '·ûè·üí·ûö·û°·ûî·üã·ûë·üÖ·ûï·üí·ûë·û∂·üÜ·ûÑ·ûÇ·üí·ûö·ûî·üã·ûÇ·üí·ûö·ûÑ',
                'booking-title': '·ûÄ·ûÄ·üã·ûü·üÅ·ûú·û∂',
                'label-confirm-name': '·ûî·ûâ·üí·ûá·û∂·ûÄ·üã·ûà·üí·ûò·üÑ·üá·ûö·ûî·ûü·üã·û¢·üí·ûì·ûÄ',
                'label-age': '·û¢·û∂·ûô·ûª',
                'label-address': '·û¢·û∂·ûü·ûô·ûä·üí·ûã·û∂·ûì·ûñ·üÅ·ûâ·ûõ·üÅ·ûâ',
                'label-farm-size': '·ûë·üÜ·û†·üÜ·ûÄ·ûü·û∑·ûä·üí·ûã·û∂·ûì (·û†·û∑·ûÄ·ûè·û∂)',
                'label-equipment': '·ûß·ûî·ûÄ·ûö·ûé·üç/·ûü·üÅ·ûú·û∂·ûä·üÇ·ûõ·ûè·üí·ûö·ûº·ûú·ûÄ·û∂·ûö',
                'label-date': '·ûÄ·û∂·ûõ·ûî·ûö·û∑·ûÖ·üí·ûÜ·üÅ·ûë·ûü·üÅ·ûú·û∂·ûä·üÇ·ûõ·ûÖ·ûÑ·üã·ûî·û∂·ûì',
                'btn-next': '·ûî·ûì·üí·ûë·û∂·ûî·üã',
                'btn-previous': '·ûò·ûª·ûì',
                'btn-submit-booking': '·ûä·û∂·ûÄ·üã·ûü·üí·ûì·ûæ·ûÄ·û∂·ûö·ûÄ·ûÄ·üã',
                'opt-tractor': '·ûè·üí·ûö·û∂·ûÄ·üã·ûë·üê·ûö',
                'opt-harvester': '·ûò·üâ·û∂·ûü·üä·û∏·ûì·ûÖ·üí·ûö·ûº·ûè·ûÄ·û∂·ûè·üã',
                'opt-plowing': '·ûü·üÅ·ûú·û∂·ûó·üí·ûá·ûΩ·ûö·ûä·û∏',
                'opt-irrigation': '·ûî·üí·ûö·ûñ·üê·ûì·üí·ûí·ûü·üí·ûö·üÑ·ûÖ·ûü·üí·ûö·ûñ',
                'opt-fertilizer': '·ûÄ·û∂·ûö·ûõ·û∂·ûî·ûá·û∏',
                'opt-other': '·ûï·üí·ûü·üÅ·ûÑ·üó',
                'success-title': '·ûî·û∂·ûì·ûî·ûâ·üí·ûá·û∂·ûÄ·üã·ûÄ·û∂·ûö·ûÄ·ûÄ·üã!',
                'success-message': '·ûü·üÜ·ûé·ûæ·ûü·üÅ·ûú·û∂·ûö·ûî·ûü·üã·û¢·üí·ûì·ûÄ·ûè·üí·ûö·ûº·ûú·ûî·û∂·ûì·ûä·û∂·ûÄ·üã·ûü·üí·ûì·ûæ·ûä·üÑ·ûô·ûá·üÑ·ûÇ·ûá·üê·ûô·üî ·ûô·ûæ·ûÑ·ûì·ûπ·ûÑ·ûë·û∂·ûÄ·üã·ûë·ûÑ·û¢·üí·ûì·ûÄ·ûÜ·û∂·ûî·üã·üó·ûì·üÅ·üá·üî',
                'btn-back-home': '·ûè·üí·ûö·û°·ûî·üã·ûë·üÖ·ûë·üÜ·ûñ·üê·ûö·ûä·ûæ·ûò',
                'processing-title': '·ûÄ·û∂·ûö·ûé·üÇ·ûì·û∂·üÜ·ûÄ·üÇ·ûÖ·üí·ûì·üÉ',
                'processing-subtitle': '·ûë·ûë·ûΩ·ûõ·ûá·üÜ·ûì·ûΩ·ûô·û¢·üÜ·ûñ·û∏·ûÄ·û∂·ûö·û¢·ûì·ûª·ûú·ûè·üí·ûè·ûÄ·üí·ûö·üÑ·ûô·ûî·üí·ûö·ûò·ûº·ûõ·ûï·ûõ',
                'voice-question-title': '·ûü·ûΩ·ûö·ûè·û∂·ûò·ûü·üÜ·û°·üÅ·ûÑ',
                'voice-question-desc': '·ûê·ûè·ûü·üÜ·ûé·ûΩ·ûö·ûö·ûî·ûü·üã·û¢·üí·ûì·ûÄ ·û†·ûæ·ûô·ûë·ûë·ûΩ·ûõ·ûÖ·ûò·üí·ûõ·ûæ·ûô',
                'video-guides-title': '·ûú·û∏·ûä·üÅ·û¢·ûº·ûé·üÇ·ûì·û∂·üÜ',
                'video-guides-desc': '·ûò·ûæ·ûõ·ûú·û∏·ûä·üÅ·û¢·ûº·ûé·üÇ·ûì·û∂·üÜ',
                'faq-title': '·ûü·üÜ·ûé·ûΩ·ûö·ûë·ûº·ûë·üÖ',
                'faq-desc': '·ûö·ûÄ·ûò·ûæ·ûõ·ûü·üÜ·ûé·ûΩ·ûö·ûä·üÇ·ûõ·ûü·ûΩ·ûö·ûâ·ûπ·ûÄ·ûâ·û∂·ûî·üã',
                'voice-rec-title': '·ûê·ûè·ûü·üÜ·ûé·ûΩ·ûö·ûö·ûî·ûü·üã·û¢·üí·ûì·ûÄ',
                'voice-rec-subtitle': '·ûÖ·ûª·ûÖ·ûî·üä·ûº·ûè·ûª·ûÑ·ûä·ûæ·ûò·üí·ûî·û∏·ûÖ·û∂·ûî·üã·ûï·üí·ûè·ûæ·ûò·ûê·ûè',
                'response-title': '·ûÖ·ûò·üí·ûõ·ûæ·ûô:',
                'video-title': '·ûú·û∏·ûä·üÅ·û¢·ûº·ûé·üÇ·ûì·û∂·üÜ',
                'video1-title': '·ûî·ûÖ·üí·ûÖ·üÅ·ûÄ·ûë·üÅ·ûü·ûü·ûò·üí·ûÑ·ûΩ·ûè·ûü·üí·ûö·ûº·ûú',
                'video1-desc': '·ûö·üÄ·ûì·ûú·û∑·ûí·û∏·ûè·üí·ûö·ûπ·ûò·ûè·üí·ûö·ûº·ûú·ûÄ·üí·ûì·ûª·ûÑ·ûÄ·û∂·ûö·ûü·ûò·üí·ûÑ·ûΩ·ûè·ûü·üí·ûö·ûº·ûú·ûî·ûì·üí·ûë·û∂·ûî·üã·ûñ·û∏·ûî·üí·ûö·ûò·ûº·ûõ·ûï·ûõ ·ûä·ûæ·ûò·üí·ûî·û∏·ûÄ·û∂·ûö·ûñ·û∂·ûö·ûï·üí·ûü·û∑·ûè ·ûì·û∑·ûÑ·ûö·ûÄ·üí·ûü·û∂·ûÇ·ûª·ûé·ûó·û∂·ûñ·üî',
                'video2-title': '·ûú·û∑·ûí·û∏·ûë·ûª·ûÄ·ûï·ûõ·û∑·ûè·ûï·ûõ·ûè·üí·ûö·ûπ·ûò·ûè·üí·ûö·ûº·ûú',
                'video2-desc': '·ûü·üí·ûú·üÇ·ûÑ·ûô·ûõ·üã·û¢·üÜ·ûñ·û∏·ûÄ·û∂·ûö·û¢·ûì·ûª·ûú·ûè·üí·ûè·ûõ·üí·û¢·ûî·üÜ·ûï·ûª·ûè·ûü·ûò·üí·ûö·û∂·ûî·üã·ûÄ·û∂·ûö·ûë·ûª·ûÄ·ûï·ûõ·û∑·ûè·ûï·ûõ ·ûä·ûæ·ûò·üí·ûî·û∏·ûî·ûÑ·üí·ûÄ·ûæ·ûì·û¢·û∂·ûô·ûª·ûÄ·û∂·ûõ ·ûì·û∑·ûÑ·ûÄ·û∂·ûè·üã·ûî·ûì·üí·ûê·ûô·ûÄ·û∂·ûö·ûÅ·û∂·ûè·ûî·ûÑ·üã·üî',
                'faq-screen-title': '·ûü·üÜ·ûé·ûΩ·ûö·ûë·ûº·ûë·üÖ',
                'faq1-q': '·ûÅ·üí·ûâ·ûª·üÜ·ûÇ·ûΩ·ûö·ûü·ûò·üí·ûÑ·ûΩ·ûè·ûü·üí·ûö·ûº·ûú·ûö·ûô·üà·ûñ·üÅ·ûõ·ûî·üâ·ûª·ûì·üí·ûò·û∂·ûì?',
                'faq1-a': '·ûü·üí·ûö·ûº·ûú·ûÇ·ûΩ·ûö·ûè·üí·ûö·ûº·ûú·ûî·û∂·ûì·ûü·ûò·üí·ûÑ·ûΩ·ûè·ûö·û†·ûº·ûè·ûä·ûõ·üã·ûò·û∂·ûè·û∑·ûÄ·û∂·ûü·üÜ·ûé·ûæ·ûò·ûà·û∂·ûì·ûä·ûõ·üã 14% ·û¨·ûë·û∂·ûî·ûá·û∂·ûÑ·ûì·üÅ·üá·üî ·ûì·üÅ·üá·ûá·û∂·ûí·ûò·üí·ûò·ûè·û∂·ûè·üí·ûö·ûº·ûú·ûÄ·û∂·ûö·ûñ·üÅ·ûõ 2-3 ·ûê·üí·ûÑ·üÉ·ûÄ·üí·ûì·ûª·ûÑ·ûõ·ûÄ·üí·ûÅ·ûÅ·ûé·üí·ûå·ûñ·üí·ûö·üá·û¢·û∂·ûë·û∑·ûè·üí·ûô·ûõ·üí·û¢·üî',
                'faq2-q': '·ûü·û∏·ûè·ûª·ûé·üí·û†·ûó·û∂·ûñ·ûî·üâ·ûª·ûì·üí·ûò·û∂·ûì·ûõ·üí·û¢·ûî·üÜ·ûï·ûª·ûè·ûü·ûò·üí·ûö·û∂·ûî·üã·ûÄ·û∂·ûö·ûë·ûª·ûÄ·ûï·ûõ·û∑·ûè·ûï·ûõ?',
                'faq2-a': '·ûï·ûõ·û∑·ûè·ûï·ûõ·ûó·û∂·ûÇ·ûÖ·üí·ûö·ûæ·ûì·ûÇ·ûΩ·ûö·ûè·üí·ûö·ûº·ûú·ûî·û∂·ûì·ûë·ûª·ûÄ·ûì·üÖ·ûü·û∏·ûè·ûª·ûé·üí·û†·ûó·û∂·ûñ 10-15¬∞C ·ûá·û∂·ûò·ûΩ·ûô·ûü·üÜ·ûé·ûæ·ûò·ûÄ·üí·ûö·üÑ·ûò 60% ·ûä·ûæ·ûò·üí·ûî·û∏·ûÄ·û∂·ûö·ûñ·û∂·ûö·ûÄ·û∂·ûö·ûÅ·ûº·ûÖ·üî',
                'faq3-q': '·ûè·ûæ·ûÅ·üí·ûâ·ûª·üÜ·ûÄ·û∂·ûö·ûñ·û∂·ûö·ûÄ·û∂·ûö·ûÜ·üí·ûõ·ûÑ·ûü·ûè·üí·ûú·ûõ·üí·û¢·û∑·ûè·ûô·üâ·û∂·ûÑ·ûä·ûº·ûÖ·ûò·üí·ûè·üÅ·ûÖ?',
                'faq3-a': '·ûí·û∂·ûì·û∂·ûÄ·û∂·ûö·ûü·ûò·üí·û¢·û∂·ûè·ûè·üÜ·ûî·ûì·üã·ûï·üí·ûë·ûª·ûÄ·û≤·üí·ûô·ûî·û∂·ûì·ûè·üí·ûö·ûπ·ûò·ûè·üí·ûö·ûº·ûú ·ûî·üí·ûö·ûæ·ûí·ûª·ûÑ·ûî·û∑·ûë·ûá·û∑·ûè ·ûì·û∑·ûÑ·ûö·ûÄ·üí·ûü·û∂·ûÄ·ûò·üí·ûö·û∑·ûè·ûü·üÜ·ûé·ûæ·ûò·û≤·üí·ûô·ûë·û∂·ûî·üî ·ûÄ·û∂·ûö·ûè·üí·ûö·ûΩ·ûè·ûñ·û∑·ûì·û∑·ûè·üí·ûô·ûá·û∂·ûë·üÄ·ûÑ·ûë·û∂·ûè·üã·ûÇ·û∫·ûü·üÜ·ûÅ·û∂·ûì·üã·üî'
            }
        };

        // Language switching
        function setLanguage(lang) {
            currentLanguage = lang;
            document.querySelectorAll('.lang-btn').forEach(btn => btn.classList.remove('active'));
            event.target.classList.add('active');

            Object.keys(translations[lang]).forEach(key => {
                const element = document.getElementById(key);
                if (element) {
                    if (element.tagName === 'INPUT' || element.tagName === 'TEXTAREA') {
                        element.placeholder = translations[lang][key];
                    } else {
                        element.textContent = translations[lang][key];
                    }
                }
            });
        }

        // Screen navigation
        function showScreen(screenId) {
            document.querySelectorAll('.screen').forEach(screen => {
                screen.classList.remove('active');
            });
            document.getElementById(screenId).classList.add('active');

            if (screenId === 'weather-screen') {
                loadWeather();
            }
        }

        // Role selection
        function selectRole(role) {
            if (role === 'farmer') {
                showScreen('registration-screen');
            } else {
                tg.showAlert('This feature is coming soon!');
            }
        }

        // Location sharing
        function shareLocation() {
            if (tg.initDataUnsafe?.user) {
                tg.showPopup({
                    title: 'Share Location',
                    message: 'Please share your farm location using Telegram location feature',
                    buttons: [{ type: 'ok' }]
                });

                setTimeout(() => {
                    document.getElementById('location-display').value = 'Phnom Penh, Cambodia';
                }, 1000);
            }
        }

        // ===== UPDATED REGISTRATION HANDLER =====
        document.getElementById('registration-form').addEventListener('submit', async function (e) {
            e.preventDefault();

            const name = document.getElementById('farmer-name').value.trim();
            const phone = document.getElementById('farmer-phone').value.trim();
            const location = document.getElementById('location-display').value.trim();

            if (!name || !phone || !location) {
                tg.showAlert(currentLanguage === 'en'
                    ? 'Please fill in all fields'
                    : '·ûü·ûº·ûò·ûî·üÜ·ûñ·üÅ·ûâ·ûõ·ûò·üí·û¢·û∑·ûè·ûõ·ûò·üí·û¢·û∑·ûè·ûë·û∂·üÜ·ûÑ·û¢·ûü·üã');
                return;
            }

            if (phone.length < 9) {
                tg.showAlert(currentLanguage === 'en'
                    ? 'Please enter a valid phone number'
                    : '·ûü·ûº·ûò·ûî·ûâ·üí·ûÖ·ûº·ûõ·ûõ·üÅ·ûÅ·ûë·ûº·ûö·ûü·üê·ûñ·üí·ûë·ûä·üÇ·ûõ·ûü·ûò·ûü·üí·ûö·ûî·ûÇ·üí·ûì·û∂');
                return;
            }

            // Show loading
            document.getElementById('registration-loading').classList.add('show');
            document.getElementById('btn-register').disabled = true;

            const telegramId = tg.initDataUnsafe?.user?.id || 'guest-' + Date.now();

            // Try to save to server
            const result = await registerUser({
                telegramId,
                name,
                phone,
                location
            });

            // Hide loading
            document.getElementById('registration-loading').classList.remove('show');
            document.getElementById('btn-register').disabled = false;

            if (result.success) {
                userData = {
                    id: result.userId,
                    telegramId,
                    name,
                    phone,
                    location
                };

                // Save to localStorage too
                localStorage.setItem('userRegistration', JSON.stringify(userData));

                document.getElementById('farmer-name-display').textContent = userData.name;
                document.getElementById('booking-name').value = userData.name;

                showScreen('dashboard-screen');
                tg.showAlert('‚úÖ Registration successful! Welcome ' + userData.name);
            } else {
                // Fallback to localStorage if server is unavailable
                console.warn('Server registration failed, using localStorage:', result.error);

                userData = {
                    id: Date.now(),
                    telegramId,
                    name,
                    phone,
                    location
                };

                localStorage.setItem('userRegistration', JSON.stringify(userData));
                document.getElementById('farmer-name-display').textContent = userData.name;
                document.getElementById('booking-name').value = userData.name;

                showScreen('dashboard-screen');
                tg.showAlert('‚úÖ Registration saved locally! (Server unavailable)');
            }
        });

        // Weather API Configuration
        const WEATHER_API_KEY = 'c4b344785f4af31d272229a65ee4ee26';

        const weatherIcons = {
            'Clear': '‚òÄÔ∏è',
            'Clouds': '‚òÅÔ∏è',
            'Rain': 'üåßÔ∏è',
            'Drizzle': 'üå¶Ô∏è',
            'Thunderstorm': '‚õàÔ∏è',
            'Snow': '‚ùÑÔ∏è',
            'Mist': 'üå´Ô∏è',
            'Fog': 'üå´Ô∏è',
            'Haze': 'üå´Ô∏è'
        };

        const weatherTranslations = {
            'Clear': { en: 'Clear Sky', km: '·ûò·üÅ·ûÉ·ûü·üí·û¢·û∂·ûè' },
            'Clouds': { en: 'Cloudy', km: '·ûò·û∂·ûì·ûñ·ûñ·ûÄ' },
            'Rain': { en: 'Rainy', km: '·ûò·û∂·ûì·ûó·üí·ûõ·üÄ·ûÑ' },
            'Drizzle': { en: 'Light Rain', km: '·ûó·üí·ûõ·üÄ·ûÑ·üó' },
            'Thunderstorm': { en: 'Thunderstorm', km: '·ûñ·üí·ûô·ûª·üá·ûï·üí·ûÇ·ûö' },
            'Snow': { en: 'Snow', km: '·ûñ·üí·ûö·û∑·ûõ' },
            'Mist': { en: 'Misty', km: '·ûò·û∂·ûì·û¢·üê·ûñ·üí·ûë' },
            'Fog': { en: 'Foggy', km: '·û¢·üê·ûñ·üí·ûë·ûÄ·üí·ûö·û∂·ûü·üã' },
            'Haze': { en: 'Hazy', km: '·û¢·üê·ûñ·üí·ûë·ûü·üí·ûö·û∂·ûõ' }
        };

        async function loadWeather() {
            const location = userData.location || 'Phnom Penh, Cambodia';
            document.getElementById('weather-location').textContent = location;

            document.getElementById('weather-temp').textContent = '--¬∞C';
            document.getElementById('weather-condition').textContent = currentLanguage === 'en' ? 'Loading...' : '·ûÄ·üÜ·ûñ·ûª·ûÑ·ûï·üí·ûë·ûª·ûÄ...';

            try {
                const geoResponse = await fetch(
                    `https://api.openweathermap.org/geo/1.0/direct?q=${encodeURIComponent(location)}&limit=1&appid=${WEATHER_API_KEY}`
                );
                const geoData = await geoResponse.json();

                if (geoData.length === 0) {
                    throw new Error('Location not found');
                }

                const { lat, lon } = geoData[0];

                const weatherResponse = await fetch(
                    `https://api.openweathermap.org/data/2.5/weather?lat=${lat}&lon=${lon}&units=metric&appid=${WEATHER_API_KEY}`
                );
                const weatherData = await weatherResponse.json();

                const temp = Math.round(weatherData.main.temp);
                const condition = weatherData.weather[0].main;
                const humidity = weatherData.main.humidity;
                const windSpeed = Math.round(weatherData.wind.speed * 3.6);
                const rainfall = weatherData.rain ? weatherData.rain['1h'] || 0 : 0;

                document.getElementById('weather-temp').textContent = `${temp}¬∞C`;
                document.getElementById('weather-icon').textContent = weatherIcons[condition] || '‚õÖ';

                const conditionText = weatherTranslations[condition]
                    ? weatherTranslations[condition][currentLanguage]
                    : condition;
                document.getElementById('weather-condition').textContent = conditionText;

                document.getElementById('weather-humidity').textContent = `${humidity}%`;
                document.getElementById('weather-wind').textContent = `${windSpeed} km/h`;
                document.getElementById('weather-rainfall').textContent = `${rainfall} mm`;

                let forecast = '';
                if (condition === 'Rain' || condition === 'Drizzle' || condition === 'Thunderstorm') {
                    forecast = currentLanguage === 'en' ? 'Continued rain expected' : '·ûö·üÜ·ûñ·ûπ·ûÑ·ûê·û∂·ûó·üí·ûõ·üÄ·ûÑ·ûî·ûì·üí·ûè';
                } else if (condition === 'Clouds') {
                    forecast = currentLanguage === 'en' ? 'Cloudy conditions' : '·û¢·û∂·ûÄ·û∂·ûü·ûò·û∂·ûì·ûñ·ûñ·ûÄ';
                } else if (condition === 'Clear') {
                    forecast = currentLanguage === 'en' ? 'Clear and sunny' : '·ûü·üí·û¢·û∂·ûè·ûì·û∑·ûÑ·ûò·û∂·ûì·ûñ·ûì·üí·ûõ·û∫·ûê·üí·ûÑ·üÉ';
                } else {
                    forecast = currentLanguage === 'en' ? 'Variable conditions' : '·û¢·û∂·ûÄ·û∂·ûü·ûí·û∂·ûè·ûª·ûî·üí·ûö·üÇ·ûî·üí·ûö·ûΩ·ûõ';
                }
                document.getElementById('weather-forecast').textContent = forecast;

            } catch (error) {
                console.error('Weather error:', error);
                document.getElementById('weather-location').textContent = 'Phnom Penh, Cambodia';
                document.getElementById('weather-temp').textContent = '--¬∞C';
                document.getElementById('weather-condition').textContent = currentLanguage === 'en'
                    ? 'Unable to load weather. Please try again.'
                    : '·ûò·û∑·ûì·û¢·û∂·ûÖ·ûï·üí·ûë·ûª·ûÄ·û¢·û∂·ûÄ·û∂·ûü·ûí·û∂·ûè·ûª·ûî·û∂·ûì·ûë·üÅ·üî ·ûü·ûº·ûò·ûñ·üí·ûô·û∂·ûô·û∂·ûò·ûò·üí·ûè·ûÑ·ûë·üÄ·ûè·üî';
            }
        }

        // Booking steps
        function nextBookingStep() {
            if (currentBookingStep < 6) {
                const currentStepElement = document.getElementById(`step-${currentBookingStep}`);
                const input = currentStepElement.querySelector('input, select, textarea');

                if (input && !input.value) {
                    tg.showAlert(currentLanguage === 'en' ? 'Please fill in this field' : '·ûü·ûº·ûò·ûî·üÜÔøΩÔøΩ·üÅ·ûâ·ûú·û∂·ûõ·ûì·üÅ·üá');
                    return;
                }

                document.getElementById(`step-${currentBookingStep}`).style.display = 'none';
                currentBookingStep++;
                document.getElementById(`step-${currentBookingStep}`).style.display = 'block';

                updateBookingProgress();
            }
        }

        function prevBookingStep() {
            if (currentBookingStep > 1) {
                document.getElementById(`step-${currentBookingStep}`).style.display = 'none';
                currentBookingStep--;
                document.getElementById(`step-${currentBookingStep}`).style.display = 'block';

                updateBookingProgress();
            }
        }

        function updateBookingProgress() {
            const progress = (currentBookingStep / 6) * 100;
            document.getElementById('booking-progress').style.width = `${progress}%`;
            document.getElementById('booking-step').textContent = `${currentLanguage === 'en' ? 'Step' : '·ûá·üÜ·û†·û∂·ûì'} ${currentBookingStep} ${currentLanguage === 'en' ? 'of' : '·ûÄ·üí·ûì·ûª·ûÑ·ûÖ·üÜ·ûé·üÑ·ûò'} 6`;
        }

        // ===== UPDATED BOOKING HANDLER =====
        document.getElementById('booking-form').addEventListener('submit', async function (e) {
            e.preventDefault();

            // Show loading
            document.getElementById('booking-loading').classList.add('show');
            document.getElementById('btn-submit-booking').disabled = true;

            const bookingData = {
                userId: userData.id || Date.now(),
                name: document.getElementById('booking-name').value,
                age: document.getElementById('booking-age').value,
                address: document.getElementById('booking-address').value,
                farmSize: document.getElementById('booking-farm-size').value,
                equipment: document.getElementById('booking-equipment').value,
                serviceDate: document.getElementById('booking-date').value
            };

            const result = await bookService(bookingData);

            // Hide loading
            document.getElementById('booking-loading').classList.remove('show');
            document.getElementById('btn-submit-booking').disabled = false;

            if (result.success) {
                // Save booking to localStorage too
                let bookings = JSON.parse(localStorage.getItem('userBookings')) || [];
                bookings.push({ ...bookingData, bookingId: result.bookingId });
                localStorage.setItem('userBookings', JSON.stringify(bookings));

                currentBookingStep = 1;
                document.querySelectorAll('.booking-step-content').forEach((step, index) => {
                    step.style.display = index === 0 ? 'block' : 'none';
                });
                updateBookingProgress();

                showScreen('booking-success-screen');
                tg.showAlert('‚úÖ Booking confirmed! Booking ID: ' + result.bookingId);
            } else {
                console.warn('Server booking failed, saving locally:', result.error);

                let bookings = JSON.parse(localStorage.getItem('userBookings')) || [];
                bookings.push({ ...bookingData, bookingId: Date.now() });
                localStorage.setItem('userBookings', JSON.stringify(bookings));

                currentBookingStep = 1;
                document.querySelectorAll('.booking-step-content').forEach((step, index) => {
                    step.style.display = index === 0 ? 'block' : 'none';
                });
                updateBookingProgress();

                showScreen('booking-success-screen');
                tg.showAlert('‚úÖ Booking saved locally! (Server unavailable)');
            }
        });

        // Voice recording
        function toggleRecording() {
            const btn = document.getElementById('voice-btn');
            const status = document.getElementById('recording-status');

            if (!isRecording) {
                isRecording = true;
                btn.classList.add('recording');
                status.textContent = currentLanguage === 'en' ? 'Recording...' : '·ûÄ·üÜ·ûñ·ûª·ûÑ·ûê·ûè...';

                setTimeout(async () => {
                    isRecording = false;
                    btn.classList.remove('recording');
                    status.textContent = currentLanguage === 'en' ? 'Processing your question...' : '·ûÄ·üÜ·ûñ·ûª·ûÑ·ûä·üÜ·ûé·ûæ·ûö·ûÄ·û∂·ûö·ûü·üÜ·ûé·ûΩ·ûö·ûö·ûî·ûü·üã·û¢·üí·ûì·ûÄ...';

                    // Simulate voice response and save to server
                    const question = currentLanguage === 'en'
                        ? 'How to dry rice properly?'
                        : '·ûè·ûæ·ûí·üí·ûú·ûæ·ûä·ûº·ûÖ·ûò·üí·ûè·üÅ·ûÖ·ûä·ûæ·ûò·üí·ûî·û∏·ûü·ûò·üí·ûÑ·ûΩ·ûè·ûü·üí·ûö·ûº·ûú·û≤·üí·ûô·ûî·û∂·ûì·ûè·üí·ûö·ûπ·ûò·ûè·üí·ûö·ûº·ûú?';

                    const response = currentLanguage === 'en'
                        ? 'To properly dry rice, spread it in a thin layer under direct sunlight. Turn it regularly and ensure moisture content drops to 14% before storage. This usually takes 2-3 days in good weather.'
                        : '·ûä·ûæ·ûò·üí·ûî·û∏·ûü·ûò·üí·ûÑ·ûΩ·ûè·ûü·üí·ûö·ûº·ûú·û≤·üí·ûô·ûî·û∂·ûì·ûè·üí·ûö·ûπ·ûò·ûè·üí·ûö·ûº·ûú ·ûï·üí·ûü·ûñ·üí·ûú·ûï·üí·ûü·û∂·ûô·ûú·û∂·ûá·û∂·ûü·üí·ûö·ûë·û∂·ûî·üã·ûü·üí·ûè·ûæ·ûÑ·ûì·üÖ·ûÄ·üí·ûö·üÑ·ûò·ûñ·ûì·üí·ûõ·û∫·ûê·üí·ûÑ·üÉ·ûï·üí·ûë·û∂·ûõ·üã·üî ·ûî·ûÑ·üí·ûú·û∑·ûõ·ûú·û∂·ûá·û∂·ûî·üí·ûö·ûÖ·û∂·üÜ ·ûì·û∑·ûÑ·ûí·û∂·ûì·û∂·ûê·û∂·ûò·û∂·ûè·û∑·ûÄ·û∂·ûü·üÜ·ûé·ûæ·ûò·ûí·üí·ûõ·û∂·ûÄ·üã·ûÖ·ûª·üá·ûä·ûõ·üã 14% ·ûò·ûª·ûì·ûñ·üÅ·ûõ·ûë·ûª·ûÄ·üî ·ûì·üÅ·üá·ûá·û∂·ûí·ûò·üí·ûò·ûè·û∂·ûè·üí·ûö·ûº·ûú·ûÄ·û∂·ûö·ûñ·üÅ·ûõ 2-3 ·ûê·üí·ûÑ·üÉ·ûÄ·üí·ûì·ûª·ûÑ·û¢·û∂·ûÄ·û∂·ûü·ûí·û∂·ûè·ûª·ûõ·üí·û¢·üî';

                    const result = await saveProcessingGuide({
                        userId: userData.id || Date.now(),
                        question,
                        response,
                        type: 'voice'
                    });

                    setTimeout(() => {
                        document.getElementById('voice-response').style.display = 'block';
                        document.getElementById('response-text').textContent = response;
                        status.textContent = currentLanguage === 'en' ? 'Response received!' : '·ûî·û∂·ûì·ûë·ûë·ûΩ·ûõ·ûÖ·ûò·üí·ûõ·ûæ·ûô!';

                        // Save to localStorage too
                        let guides = JSON.parse(localStorage.getItem('processingGuides')) || [];
                        guides.push({ question, response, type: 'voice', timestamp: new Date().toISOString() });
                        localStorage.setItem('processingGuides', JSON.stringify(guides));
                    }, 1500);
                }, 3000);
            }
        }

        // FAQ toggle
        function toggleFAQ(num) {
            const answer = document.getElementById(`faq-${num}`);
            answer.classList.toggle('show');
        }

        // Load user data on page load
        window.addEventListener('load', function () {
            const savedData = localStorage.getItem('userRegistration');
            if (savedData) {
                userData = JSON.parse(savedData);
                document.getElementById('farmer-name-display').textContent = userData.name;
                document.getElementById('booking-name').value = userData.name;
            }
            loadWeather();
        });
    </script>
</body>

</html>